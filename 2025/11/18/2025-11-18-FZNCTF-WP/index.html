
<!DOCTYPE html>
<html lang="zh" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2025-11-18-FZNCTF_WP - 二月の档案室</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="二月,"> 
    <meta name="description" content="所感所想，所言所行，我将以文字记录我自己。,FZNCTF 2025这次最高18名，后面打不动了掉到了29名
WEB 签到 check_in123456曰：北天始精灵玉仙凶乐玄梵神生梵融劫冥华炁渺霄阿东陀冥色净荡象象空仙阿魂东灵渺莽空西魄命梵玄,"> 
    <meta name="author" content="Allureluoli"> 
    <link rel="alternative" href="atom.xml" title="二月の档案室" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

    
    
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:title" content="2025-11-18-FZNCTF_WP - 二月の档案室"/>
    <meta name="twitter:description" content="所感所想，所言所行，我将以文字记录我自己。,FZNCTF 2025这次最高18名，后面打不动了掉到了29名
WEB 签到 check_in123456曰：北天始精灵玉仙凶乐玄梵神生梵融劫冥华炁渺霄阿东陀冥色净荡象象空仙阿魂东灵渺莽空西魄命梵玄,"/>
    
    
    
    
    <meta property="og:site_name" content="二月の档案室"/>
    <meta property="og:type" content="object"/>
    <meta property="og:title" content="2025-11-18-FZNCTF_WP - 二月の档案室"/>
    <meta property="og:description" content="所感所想，所言所行，我将以文字记录我自己。,FZNCTF 2025这次最高18名，后面打不动了掉到了29名
WEB 签到 check_in123456曰：北天始精灵玉仙凶乐玄梵神生梵融劫冥华炁渺霄阿东陀冥色净荡象象空仙阿魂东灵渺莽空西魄命梵玄,"/>
    
<link rel="stylesheet" href="/css/diaspora.css">

    <script>window.searchDbPath = "/search.xml";</script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&display=swap" rel="stylesheet">
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="loading">
    <span id="config-title" style="display:none">二月の档案室</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="iconfont icon-home image-icon" href="javascript:;" data-url="https://blog.curesky.site"></a>
    <div title="播放/暂停" class="iconfont icon-play"></div>
    <h3 class="subtitle">2025-11-18-FZNCTF_WP</h3>
    <div class="social">
        <div>
            <div class="share">
                <a title="获取二维码" class="iconfont icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">2025-11-18-FZNCTF_WP</h1>
        <div class="stuff">
            <span>十一月 18, 2025</span>
            
  <ul class="post-tags-list" itemprop="keywords"><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" rel="tag">网络安全</a></li></ul>


        </div>
        <div class="content markdown">
            <h3 id="FZNCTF-2025"><a href="#FZNCTF-2025" class="headerlink" title="FZNCTF 2025"></a>FZNCTF 2025</h3><p>这次最高18名，后面打不动了掉到了29名</p>
<h4 id="WEB-签到-check-in"><a href="#WEB-签到-check-in" class="headerlink" title="WEB 签到 check_in"></a>WEB 签到 check_in</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">曰：北天始精灵玉仙凶乐玄梵神生梵融劫冥华炁渺霄阿东陀冥色净荡象象空仙阿魂东灵渺莽空西魄命梵玄坤生威人莽玉魂观终威仙道霄浩太劫始周东凶魂照龙浩仙浩仙清精北色御尊尊</span><br><span class="line">曰：北茫天实虚周北茫灵魂微始道魄色净度劫华照始真幽玄融观阎虚净照莽度照幽运融天地东罗鬼阿冥界渺人道莽炁魄吉太魂西冥鬼华玉天地净霄观北鬼天渺界元坤灵幽人清运度魔道灵清终华玉劫南地观太人始渺幽微终龙南乐灵凶始清虚地阿渺玄真终荡浩南北吉鬼象道界终色净阎周地界观北龙玄魔魂度观量茫南精幽坤浩仙真魄空罗渺实阿地魄冥鬼天魂玉净阎南周阿度西终命精度观鬼净融华梵炁真实太北南幽西真莽炁量度灵界炁霄威魔融阎魄人净劫元陀威幽量炁浩灵太色陀梵实人终元象精炁空真浩龙终冥魂御命终玄道冥鬼阿鬼命灵周陀魄东劫运元玉度阿地莽吉灵命始道威量微灵命幽凶凶凶仙界玉地魄生色吉神生东东太荡运观南度华精御真华梵运灵北周太天龙神劫梵魂实吉周太照乐真界魔冥生凶龙元华观界劫冥人冥度莽阿阎威命东微坤威劫阎人度浩阎太威东劫界人微观生陀御仙阎南融南荡量真元南人神陀融仙西乐神凶乐元罗阎天莽东地南西西魄运</span><br><span class="line">曰：太太周威西御魂乐灵度坤融梵虚鬼玄炁色元渺道玉神魄炁陀仙仙北阿劫人荡茫真浩西灵冥荡终霄坤魂空元元浩陀坤天观荡威清荡幽净劫阎色精凶玄冥观北虚玉照凶虚终冥量坤观神莽乐魄幽实照度浩象浩道御周威微阿东运魄华天魔吉元吉空实陀魄劫西元西周命观阿神南命天空神劫乐空神元界罗冥命精幽地凶融坤龙始冥度鬼凶华神界道凶梵度东威精炁命坤渺茫坤清终冥虚地御色融南陀人罗梵神神魔坤空净坤冥幽玄人玉象渺凶命西阿净象真阎净玄清虚凶照运界北灵度凶色精象魄灵清空鬼微陀虚运罗界人南始虚周西命终凶南陀元阎劫命清御凶命南度度界乐劫元玉浩清华浩阿霄终界华劫始浩陀玄灵运净御阿南始劫阎微荡融净坤色清观渺仙终阿精虚始莽梵玉虚虚尊</span><br><span class="line">曰：坤魄实周界神色凶真道罗真威陀吉坤威幽莽人实霄始太融西运霄东魂霄象浩玉实魂坤北照微色魄地观命冥神度色人荡人幽玉神实元照坤精威浩吉霄魄威霄玉灵清坤空乐荡炁真东度乐魂道人梵玉空威灵度实命南荡元净渺威照始罗威始吉地道虚威华玉精御命莽仙量真梵荡灵象周霄浩魂元量浩道坤清御凶阿太乐幽劫运天融凶浩道威天虚华周道龙命量真阎炁威魄实运地魄乐精实冥精融生西人华观魄鬼运霄界精东仙北凶元量人人清地玉梵真浩南浩运真神仙陀命神西精西太劫莽照天空炁太魔御度照空罗荡仙量华威幽人生魂坤莽魔生净魂量地乐劫龙实生南坤灵地御威实人玄度神生道天观南罗色魂南魂界鬼玄实融象荡量周天空净莽微人冥吉太终劫乐始梵罗空量道地东玉罗真观清仙荡梵命命灵北运魔天玄量浩西空渺</span><br><span class="line"></span><br><span class="line">Raboutttt说CTF很有意思，先这样再那样最后再这样就好了，学会了吗，你来试试吧</span><br></pre></td></tr></table></figure>

<ul>
<li>题目提示需要工具，以为是工具搜集题目，在网上找到了题目的原作者 天书加密</li>
<li>https:&#x2F;&#x2F;github.com&#x2F;BlackCat184&#x2F;Sealed-Book</li>
<li>但是发现没有密钥解不出来，于是继续猜测最终结果如下：</li>
<li>访问&#x2F;robots.txt 拿到关键信息 1<ul>
<li>提示有1.py 2.py两个脚本可以下载</li>
</ul>
</li>
</ul>
<p>脚本1</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># 项目改自：https://github.com/BlackCat184/Sealed-Book</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Tuple</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[错误] 需要安装 pycryptodome，请运行：pip install pycryptodome&quot;</span>, file=sys.stderr)</span><br><span class="line">    <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DEFAULT_PASSWORD = <span class="string">&quot;F.Z.N CTF&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">evp_bytes_to_key</span>(<span class="params">password: <span class="built_in">bytes</span>, salt: <span class="built_in">bytes</span>, key_len: <span class="built_in">int</span>, iv_len: <span class="built_in">int</span></span>) -&gt; <span class="type">Tuple</span>[<span class="built_in">bytes</span>, <span class="built_in">bytes</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;OpenSSL EVP_BytesToKey (MD5) 派生 key 和 iv。&quot;&quot;&quot;</span></span><br><span class="line">    d = <span class="string">b&quot;&quot;</span></span><br><span class="line">    prev = <span class="string">b&quot;&quot;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(d) &lt; key_len + iv_len:</span><br><span class="line">        prev = hashlib.md5(prev + password + salt).digest()</span><br><span class="line">        d += prev</span><br><span class="line">    key = d[:key_len]</span><br><span class="line">    iv = d[key_len:key_len + iv_len]</span><br><span class="line">    <span class="keyword">return</span> key, iv</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pkcs7_pad</span>(<span class="params">data: <span class="built_in">bytes</span>, block_size: <span class="built_in">int</span> = <span class="number">16</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    pad_len = block_size - (<span class="built_in">len</span>(data) % block_size)</span><br><span class="line">    <span class="keyword">return</span> data + <span class="built_in">bytes</span>([pad_len] * pad_len)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MAP_FORWARD = [</span><br><span class="line">    (<span class="string">&quot;e&quot;</span>, <span class="string">&quot;渺&quot;</span>), (<span class="string">&quot;E&quot;</span>, <span class="string">&quot;莽&quot;</span>), (<span class="string">&quot;t&quot;</span>, <span class="string">&quot;茫&quot;</span>), (<span class="string">&quot;T&quot;</span>, <span class="string">&quot;乐&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;a&quot;</span>, <span class="string">&quot;生&quot;</span>), (<span class="string">&quot;A&quot;</span>, <span class="string">&quot;终&quot;</span>), (<span class="string">&quot;o&quot;</span>, <span class="string">&quot;仙&quot;</span>), (<span class="string">&quot;O&quot;</span>, <span class="string">&quot;鬼&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;i&quot;</span>, <span class="string">&quot;人&quot;</span>), (<span class="string">&quot;I&quot;</span>, <span class="string">&quot;吉&quot;</span>), (<span class="string">&quot;n&quot;</span>, <span class="string">&quot;凶&quot;</span>), (<span class="string">&quot;N&quot;</span>, <span class="string">&quot;清&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;s&quot;</span>, <span class="string">&quot;灵&quot;</span>), (<span class="string">&quot;S&quot;</span>, <span class="string">&quot;空&quot;</span>), (<span class="string">&quot;h&quot;</span>, <span class="string">&quot;命&quot;</span>), (<span class="string">&quot;H&quot;</span>, <span class="string">&quot;精&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;r&quot;</span>, <span class="string">&quot;炁&quot;</span>), (<span class="string">&quot;R&quot;</span>, <span class="string">&quot;神&quot;</span>), (<span class="string">&quot;d&quot;</span>, <span class="string">&quot;魔&quot;</span>), (<span class="string">&quot;D&quot;</span>, <span class="string">&quot;梵&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;l&quot;</span>, <span class="string">&quot;周&quot;</span>), (<span class="string">&quot;L&quot;</span>, <span class="string">&quot;量&quot;</span>), (<span class="string">&quot;c&quot;</span>, <span class="string">&quot;道&quot;</span>), (<span class="string">&quot;C&quot;</span>, <span class="string">&quot;天&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;u&quot;</span>, <span class="string">&quot;地&quot;</span>), (<span class="string">&quot;U&quot;</span>, <span class="string">&quot;荡&quot;</span>), (<span class="string">&quot;m&quot;</span>, <span class="string">&quot;度&quot;</span>), (<span class="string">&quot;M&quot;</span>, <span class="string">&quot;罗&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;w&quot;</span>, <span class="string">&quot;色&quot;</span>), (<span class="string">&quot;W&quot;</span>, <span class="string">&quot;元&quot;</span>), (<span class="string">&quot;f&quot;</span>, <span class="string">&quot;始&quot;</span>), (<span class="string">&quot;F&quot;</span>, <span class="string">&quot;玄&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;g&quot;</span>, <span class="string">&quot;御&quot;</span>), (<span class="string">&quot;G&quot;</span>, <span class="string">&quot;浩&quot;</span>), (<span class="string">&quot;y&quot;</span>, <span class="string">&quot;劫&quot;</span>), (<span class="string">&quot;Y&quot;</span>, <span class="string">&quot;虚&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;p&quot;</span>, <span class="string">&quot;界&quot;</span>), (<span class="string">&quot;P&quot;</span>, <span class="string">&quot;真&quot;</span>), (<span class="string">&quot;b&quot;</span>, <span class="string">&quot;实&quot;</span>), (<span class="string">&quot;B&quot;</span>, <span class="string">&quot;华&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;v&quot;</span>, <span class="string">&quot;威&quot;</span>), (<span class="string">&quot;V&quot;</span>, <span class="string">&quot;运&quot;</span>), (<span class="string">&quot;k&quot;</span>, <span class="string">&quot;魂&quot;</span>), (<span class="string">&quot;K&quot;</span>, <span class="string">&quot;魄&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;j&quot;</span>, <span class="string">&quot;融&quot;</span>), (<span class="string">&quot;J&quot;</span>, <span class="string">&quot;象&quot;</span>), (<span class="string">&quot;x&quot;</span>, <span class="string">&quot;霄&quot;</span>), (<span class="string">&quot;X&quot;</span>, <span class="string">&quot;冥&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;q&quot;</span>, <span class="string">&quot;照&quot;</span>), (<span class="string">&quot;Q&quot;</span>, <span class="string">&quot;净&quot;</span>), (<span class="string">&quot;z&quot;</span>, <span class="string">&quot;微&quot;</span>), (<span class="string">&quot;Z&quot;</span>, <span class="string">&quot;幽&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;0&quot;</span>, <span class="string">&quot;观&quot;</span>), (<span class="string">&quot;1&quot;</span>, <span class="string">&quot;陀&quot;</span>), (<span class="string">&quot;2&quot;</span>, <span class="string">&quot;阿&quot;</span>), (<span class="string">&quot;3&quot;</span>, <span class="string">&quot;龙&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;4&quot;</span>, <span class="string">&quot;阎&quot;</span>), (<span class="string">&quot;5&quot;</span>, <span class="string">&quot;东&quot;</span>), (<span class="string">&quot;6&quot;</span>, <span class="string">&quot;西&quot;</span>), (<span class="string">&quot;7&quot;</span>, <span class="string">&quot;南&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;8&quot;</span>, <span class="string">&quot;北&quot;</span>), (<span class="string">&quot;9&quot;</span>, <span class="string">&quot;玉&quot;</span>), (<span class="string">&quot;+&quot;</span>, <span class="string">&quot;太&quot;</span>), (<span class="string">&quot;/&quot;</span>, <span class="string">&quot;坤&quot;</span>), (<span class="string">&quot;=&quot;</span>, <span class="string">&quot;尊&quot;</span>),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">apply_forward_mapping</span>(<span class="params">s: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">for</span> a, b <span class="keyword">in</span> MAP_FORWARD:</span><br><span class="line">        s = s.replace(a, b)</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">seal_encrypt</span>(<span class="params">plaintext: <span class="built_in">str</span>, password: <span class="built_in">str</span> = DEFAULT_PASSWORD</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line"></span><br><span class="line">    salt = os.urandom(<span class="number">8</span>)</span><br><span class="line">    key, iv = evp_bytes_to_key(password.encode(<span class="string">&quot;utf-8&quot;</span>), salt, key_len=<span class="number">32</span>, iv_len=<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">    data = plaintext.encode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    ct = cipher.encrypt(pkcs7_pad(data))</span><br><span class="line"></span><br><span class="line">    raw = <span class="string">b&quot;Salted__&quot;</span> + salt + ct</span><br><span class="line">    b64 = base64.b64encode(raw).decode(<span class="string">&quot;ascii&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> b64.startswith(<span class="string">&quot;U2FsdGVkX1&quot;</span>), <span class="string">&quot;Base64 前缀不符&quot;</span></span><br><span class="line">    mapped = apply_forward_mapping(b64[<span class="number">10</span>:])</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;曰：&quot;</span> + mapped</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&quot;天书加密（Python）&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--text&quot;</span>, required=<span class="literal">True</span>, <span class="built_in">help</span>=<span class="string">&quot;待加密明文&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--key&quot;</span>, default=DEFAULT_PASSWORD, <span class="built_in">help</span>=<span class="string">&quot;密钥（默认 BlackCat184）&quot;</span>)</span><br><span class="line">    args, _unknown = parser.parse_known_args()</span><br><span class="line"></span><br><span class="line">    out = seal_encrypt(args.text, args.key)</span><br><span class="line">    <span class="built_in">print</span>(out)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>脚本2</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># 项目改自：https://github.com/BlackCat184/Sealed-Book</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Tuple</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line">    <span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> unpad</span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[错误] 需要安装 pycryptodome，请运行：pip install pycryptodome&quot;</span>, file=sys.stderr)</span><br><span class="line">    <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line">DEFAULT_PASSWORD = <span class="string">&quot;BlackCat184&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 与加密脚本完全对应的反向字符映射</span></span><br><span class="line">MAP_BACKWARD = [</span><br><span class="line">    (<span class="string">&quot;渺&quot;</span>, <span class="string">&quot;e&quot;</span>), (<span class="string">&quot;莽&quot;</span>, <span class="string">&quot;E&quot;</span>), (<span class="string">&quot;茫&quot;</span>, <span class="string">&quot;t&quot;</span>), (<span class="string">&quot;乐&quot;</span>, <span class="string">&quot;T&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;生&quot;</span>, <span class="string">&quot;a&quot;</span>), (<span class="string">&quot;终&quot;</span>, <span class="string">&quot;A&quot;</span>), (<span class="string">&quot;仙&quot;</span>, <span class="string">&quot;o&quot;</span>), (<span class="string">&quot;鬼&quot;</span>, <span class="string">&quot;O&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;人&quot;</span>, <span class="string">&quot;i&quot;</span>), (<span class="string">&quot;吉&quot;</span>, <span class="string">&quot;I&quot;</span>), (<span class="string">&quot;凶&quot;</span>, <span class="string">&quot;n&quot;</span>), (<span class="string">&quot;清&quot;</span>, <span class="string">&quot;N&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;灵&quot;</span>, <span class="string">&quot;s&quot;</span>), (<span class="string">&quot;空&quot;</span>, <span class="string">&quot;S&quot;</span>), (<span class="string">&quot;命&quot;</span>, <span class="string">&quot;h&quot;</span>), (<span class="string">&quot;精&quot;</span>, <span class="string">&quot;H&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;炁&quot;</span>, <span class="string">&quot;r&quot;</span>), (<span class="string">&quot;神&quot;</span>, <span class="string">&quot;R&quot;</span>), (<span class="string">&quot;魔&quot;</span>, <span class="string">&quot;d&quot;</span>), (<span class="string">&quot;梵&quot;</span>, <span class="string">&quot;D&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;周&quot;</span>, <span class="string">&quot;l&quot;</span>), (<span class="string">&quot;量&quot;</span>, <span class="string">&quot;L&quot;</span>), (<span class="string">&quot;道&quot;</span>, <span class="string">&quot;c&quot;</span>), (<span class="string">&quot;天&quot;</span>, <span class="string">&quot;C&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;地&quot;</span>, <span class="string">&quot;u&quot;</span>), (<span class="string">&quot;荡&quot;</span>, <span class="string">&quot;U&quot;</span>), (<span class="string">&quot;度&quot;</span>, <span class="string">&quot;m&quot;</span>), (<span class="string">&quot;罗&quot;</span>, <span class="string">&quot;M&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;色&quot;</span>, <span class="string">&quot;w&quot;</span>), (<span class="string">&quot;元&quot;</span>, <span class="string">&quot;W&quot;</span>), (<span class="string">&quot;始&quot;</span>, <span class="string">&quot;f&quot;</span>), (<span class="string">&quot;玄&quot;</span>, <span class="string">&quot;F&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;御&quot;</span>, <span class="string">&quot;g&quot;</span>), (<span class="string">&quot;浩&quot;</span>, <span class="string">&quot;G&quot;</span>), (<span class="string">&quot;劫&quot;</span>, <span class="string">&quot;y&quot;</span>), (<span class="string">&quot;虚&quot;</span>, <span class="string">&quot;Y&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;界&quot;</span>, <span class="string">&quot;p&quot;</span>), (<span class="string">&quot;真&quot;</span>, <span class="string">&quot;P&quot;</span>), (<span class="string">&quot;实&quot;</span>, <span class="string">&quot;b&quot;</span>), (<span class="string">&quot;华&quot;</span>, <span class="string">&quot;B&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;威&quot;</span>, <span class="string">&quot;v&quot;</span>), (<span class="string">&quot;运&quot;</span>, <span class="string">&quot;V&quot;</span>), (<span class="string">&quot;魂&quot;</span>, <span class="string">&quot;k&quot;</span>), (<span class="string">&quot;魄&quot;</span>, <span class="string">&quot;K&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;融&quot;</span>, <span class="string">&quot;j&quot;</span>), (<span class="string">&quot;象&quot;</span>, <span class="string">&quot;J&quot;</span>), (<span class="string">&quot;霄&quot;</span>, <span class="string">&quot;x&quot;</span>), (<span class="string">&quot;冥&quot;</span>, <span class="string">&quot;X&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;照&quot;</span>, <span class="string">&quot;q&quot;</span>), (<span class="string">&quot;净&quot;</span>, <span class="string">&quot;Q&quot;</span>), (<span class="string">&quot;微&quot;</span>, <span class="string">&quot;z&quot;</span>), (<span class="string">&quot;幽&quot;</span>, <span class="string">&quot;Z&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;观&quot;</span>, <span class="string">&quot;0&quot;</span>), (<span class="string">&quot;陀&quot;</span>, <span class="string">&quot;1&quot;</span>), (<span class="string">&quot;阿&quot;</span>, <span class="string">&quot;2&quot;</span>), (<span class="string">&quot;龙&quot;</span>, <span class="string">&quot;3&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;阎&quot;</span>, <span class="string">&quot;4&quot;</span>), (<span class="string">&quot;东&quot;</span>, <span class="string">&quot;5&quot;</span>), (<span class="string">&quot;西&quot;</span>, <span class="string">&quot;6&quot;</span>), (<span class="string">&quot;南&quot;</span>, <span class="string">&quot;7&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;北&quot;</span>, <span class="string">&quot;8&quot;</span>), (<span class="string">&quot;玉&quot;</span>, <span class="string">&quot;9&quot;</span>), (<span class="string">&quot;太&quot;</span>, <span class="string">&quot;+&quot;</span>), (<span class="string">&quot;坤&quot;</span>, <span class="string">&quot;/&quot;</span>), (<span class="string">&quot;尊&quot;</span>, <span class="string">&quot;=&quot;</span>),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">apply_backward_mapping</span>(<span class="params">s: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;将中文字符反向映射回Base64字符[3](@ref)&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> chinese_char, base64_char <span class="keyword">in</span> MAP_BACKWARD:</span><br><span class="line">        s = s.replace(chinese_char, base64_char)</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">evp_bytes_to_key</span>(<span class="params">password: <span class="built_in">bytes</span>, salt: <span class="built_in">bytes</span>, key_len: <span class="built_in">int</span>, iv_len: <span class="built_in">int</span></span>) -&gt; <span class="type">Tuple</span>[<span class="built_in">bytes</span>, <span class="built_in">bytes</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;OpenSSL EVP_BytesToKey (MD5) 派生 key 和 iv，与加密完全一致[1,6](@ref)&quot;&quot;&quot;</span></span><br><span class="line">    d = <span class="string">b&quot;&quot;</span></span><br><span class="line">    prev = <span class="string">b&quot;&quot;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(d) &lt; key_len + iv_len:</span><br><span class="line">        prev = hashlib.md5(prev + password + salt).digest()</span><br><span class="line">        d += prev</span><br><span class="line">    key = d[:key_len]</span><br><span class="line">    iv = d[key_len:key_len + iv_len]</span><br><span class="line">    <span class="keyword">return</span> key, iv</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">seal_decrypt</span>(<span class="params">ciphertext: <span class="built_in">str</span>, password: <span class="built_in">str</span> = DEFAULT_PASSWORD</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;解密天书加密的内容[1,7](@ref)&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ciphertext.startswith(<span class="string">&quot;曰：&quot;</span>):</span><br><span class="line">        ciphertext = ciphertext[<span class="number">2</span>:]</span><br><span class="line"></span><br><span class="line">    base64_str = apply_backward_mapping(ciphertext)</span><br><span class="line"></span><br><span class="line">    full_base64 = <span class="string">&quot;U2FsdGVkX1&quot;</span> + base64_str</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        raw_data = base64.b64decode(full_base64)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;Base64解码失败，请检查密文格式&quot;</span>) <span class="keyword">from</span> e</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(raw_data) &lt; <span class="number">16</span> <span class="keyword">or</span> <span class="keyword">not</span> raw_data.startswith(<span class="string">b&quot;Salted__&quot;</span>):</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;无效的密文格式：缺少&#x27;Salted__&#x27;前缀&quot;</span>)</span><br><span class="line"></span><br><span class="line">    salt = raw_data[<span class="number">8</span>:<span class="number">16</span>]  </span><br><span class="line">    encrypted_data = raw_data[<span class="number">16</span>:]  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    key, iv = evp_bytes_to_key(password.encode(<span class="string">&quot;utf-8&quot;</span>), salt, key_len=<span class="number">32</span>, iv_len=<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">    cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        decrypted_padded = cipher.decrypt(encrypted_data)</span><br><span class="line">        decrypted = unpad(decrypted_padded, AES.block_size)</span><br><span class="line">    <span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;解密失败：可能是密码错误或密文损坏&quot;</span>) <span class="keyword">from</span> e</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> decrypted.decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&quot;天书解密（Python）&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--text&quot;</span>, required=<span class="literal">True</span>, <span class="built_in">help</span>=<span class="string">&quot;待解密的密文（以&#x27;曰：&#x27;开头）&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--key&quot;</span>, default=DEFAULT_PASSWORD, <span class="built_in">help</span>=<span class="string">&quot;密钥（必须与加密时相同）&quot;</span>)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        plaintext = seal_decrypt(args.text, args.key)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;解密结果: <span class="subst">&#123;plaintext&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;解密失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>一个加密一个解密 在加密脚本里找到了密钥</p>
<p><code>DEFAULT_PASSWORD = &quot;F.Z.N CTF&quot;</code></p>
<p>随后使用脚本解密 得出flag</p>
<h3 id="重定向"><a href="#重定向" class="headerlink" title="重定向?"></a>重定向?</h3><p>（题目名字忘了）一直等官方wp一直没出</p>
<ul>
<li><p>访问题目网站发现有个?link参数 可以跳转到别的访问</p>
</li>
<li><p>访问帮助页面发现flag位置在 题目地址&#x2F;flag</p>
</li>
</ul>
<p>猜测这是通过重定向来访问文件实现越权</p>
<p>先通过引发报错，得到了内网监听的端口是 7000</p>
<ul>
<li>构造URL  link&#x3D;http:&#x2F;&#x2F;127.0.0.1:7000&#x2F;flag</li>
</ul>
<p>发现被过滤，多个地址均被过滤，但是域名未被过滤</p>
<p>于是我手动DNS了一个域名指向本地地址</p>
<p>xxx.xxx.xx&#x2F;flag</p>
<p>然后让构造访问，直接拿到flag</p>
<h3 id="诸神的三试炼"><a href="#诸神的三试炼" class="headerlink" title="诸神的三试炼"></a>诸神的三试炼</h3><p>第一段flag</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">_BOOL8 __fastcall <span class="title function_">flag1</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">32</span>]; <span class="comment">// [rsp+40h] [rbp-20h] BYREF</span></span><br><span class="line"></span><br><span class="line">  _mingw_snprintf(</span><br><span class="line">    buf,</span><br><span class="line">    <span class="number">0x14</span>ui64,</span><br><span class="line">    <span class="string">&quot;%s%s%s%s&quot;</span>,</span><br><span class="line">    (<span class="type">const</span> <span class="type">char</span> *)f_str,</span><br><span class="line">    (<span class="type">const</span> <span class="type">char</span> *)l_str,</span><br><span class="line">    (<span class="type">const</span> <span class="type">char</span> *)open_brace,</span><br><span class="line">    G00d_str);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">strcmp</span>(a1, buf) == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第二段flag</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">_BOOL8 __fastcall <span class="title function_">flag2</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">char</span> Str2[<span class="number">14</span>]; <span class="comment">// [rsp+22h] [rbp-3Eh] BYREF</span></span><br><span class="line">  _DWORD v7[<span class="number">4</span>]; <span class="comment">// [rsp+30h] [rbp-30h]</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [rsp+40h] [rbp-20h]</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [rsp+44h] [rbp-1Ch]</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [rsp+48h] [rbp-18h]</span></span><br><span class="line">  <span class="type">int</span> data; <span class="comment">// [rsp+4Ch] [rbp-14h]</span></span><br><span class="line">  <span class="type">char</span> v12; <span class="comment">// [rsp+50h] [rbp-10h]</span></span><br><span class="line">  <span class="type">char</span> v13; <span class="comment">// [rsp+51h] [rbp-Fh]</span></span><br><span class="line">  <span class="type">char</span> v14; <span class="comment">// [rsp+52h] [rbp-Eh]</span></span><br><span class="line">  <span class="type">char</span> v15; <span class="comment">// [rsp+53h] [rbp-Dh]</span></span><br><span class="line">  <span class="type">int</span> v16; <span class="comment">// [rsp+54h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+58h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> v18; <span class="comment">// [rsp+5Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  data = get_data(<span class="number">0</span>i64);</span><br><span class="line">  v10 = get_data(<span class="number">1</span>i64);</span><br><span class="line">  v9 = get_data(<span class="number">2</span>i64);</span><br><span class="line">  v8 = get_data(<span class="number">3</span>i64);</span><br><span class="line">  <span class="built_in">memset</span>(Str2, <span class="number">0</span>, <span class="keyword">sizeof</span>(Str2));</span><br><span class="line">  v18 = <span class="number">0</span>;</span><br><span class="line">  v7[<span class="number">0</span>] = data;</span><br><span class="line">  v7[<span class="number">1</span>] = v10;</span><br><span class="line">  v7[<span class="number">2</span>] = v9;</span><br><span class="line">  v7[<span class="number">3</span>] = v8;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v16 = v7[i];</span><br><span class="line">    v14 = BYTE1(v16);</span><br><span class="line">    v15 = v16;</span><br><span class="line">    v12 = HIBYTE(v16);</span><br><span class="line">    v13 = BYTE2(v16);</span><br><span class="line">    <span class="keyword">if</span> ( v18 &lt;= <span class="number">12</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v1 = v18++;</span><br><span class="line">      Str2[v1] = v15;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v18 &lt;= <span class="number">12</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v2 = v18++;</span><br><span class="line">      Str2[v2] = v14;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v18 &lt;= <span class="number">12</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v3 = v18++;</span><br><span class="line">      Str2[v3] = v13;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v18 &lt;= <span class="number">12</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v4 = v18++;</span><br><span class="line">      Str2[v4] = v12;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  Str2[<span class="number">13</span>] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">strcmp</span>(a1, Str2) == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__int64 __fastcall <span class="title function_">get_data</span><span class="params">(<span class="type">int</span> a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> ( a1 == <span class="number">3</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">95</span>i64;</span><br><span class="line">  <span class="keyword">if</span> ( a1 &lt;= <span class="number">3</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">switch</span> ( a1 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1849713503</span>i64;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1999654495</span>i64;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1429240159</span>i64;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>i64;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>直接写逆向脚本来解</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_flag1</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;解密第一部分flag&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=== Part 1 Decryption ===&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 根据flag1函数，第一部分是字符串拼接</span></span><br><span class="line">    <span class="comment"># f_str + l_str + open_brace + G00d_str</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 从.data段可以推断这些字符串的内容</span></span><br><span class="line">    <span class="comment"># f_str 可能对应 &quot;f&quot; 或 &quot;flag&quot;</span></span><br><span class="line">    <span class="comment"># l_str 可能对应 &quot;l&quot; 或 &quot;lag&quot;</span></span><br><span class="line">    <span class="comment"># open_brace 可能是 &quot;&#123;&quot;</span></span><br><span class="line">    <span class="comment"># G00d_str 是 &quot;G00d!!!&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 常见的flag开头是 &quot;flag&#123;&quot;</span></span><br><span class="line">    part1 = <span class="string">&quot;flag&#123;G00d!!!&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Part 1: <span class="subst">&#123;part1&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> part1</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_flag2</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;解密第二部分flag&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n=== Part 2 Decryption ===&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 根据flag2函数，从get_data获取数据并重组</span></span><br><span class="line">    data_values = [</span><br><span class="line">        get_data(<span class="number">0</span>),  <span class="comment"># 1999654495</span></span><br><span class="line">        get_data(<span class="number">1</span>),  <span class="comment"># 1429240159</span></span><br><span class="line">        get_data(<span class="number">2</span>),  <span class="comment"># 1849713503</span></span><br><span class="line">        get_data(<span class="number">3</span>)   <span class="comment"># 95</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Data values: <span class="subst">&#123;[<span class="built_in">hex</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> data_values]&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将每个32位整数拆分为4个字节</span></span><br><span class="line">    Str2 = []</span><br><span class="line">    v18 = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> value <span class="keyword">in</span> data_values:</span><br><span class="line">        <span class="comment"># 拆分为字节: [b0, b1, b2, b3]</span></span><br><span class="line">        bytes_list = [</span><br><span class="line">            value &amp; <span class="number">0xFF</span>,           <span class="comment"># v15 - 最低字节</span></span><br><span class="line">            (value &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>,    <span class="comment"># v14</span></span><br><span class="line">            (value &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>,   <span class="comment"># v13</span></span><br><span class="line">            (value &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xFF</span>    <span class="comment"># v12 - 最高字节</span></span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Value <span class="subst">&#123;<span class="built_in">hex</span>(value)&#125;</span> -&gt; bytes: <span class="subst">&#123;[<span class="built_in">hex</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> bytes_list]&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 按顺序添加到Str2</span></span><br><span class="line">        <span class="keyword">for</span> byte <span class="keyword">in</span> bytes_list:</span><br><span class="line">            <span class="keyword">if</span> v18 &lt;= <span class="number">12</span>:</span><br><span class="line">                Str2.append(byte)</span><br><span class="line">                v18 += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 转换为字符串</span></span><br><span class="line">    part2 = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> byte <span class="keyword">in</span> Str2:</span><br><span class="line">        <span class="keyword">if</span> <span class="number">32</span> &lt;= byte &lt;= <span class="number">126</span>:</span><br><span class="line">            part2 += <span class="built_in">chr</span>(byte)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            part2 += <span class="string">f&quot;\\x<span class="subst">&#123;byte:02x&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Part 2 bytes: <span class="subst">&#123;[<span class="built_in">hex</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> Str2]&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Part 2: <span class="subst">&#123;part2&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 尝试ASCII显示</span></span><br><span class="line">    ascii_part2 = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> byte <span class="keyword">in</span> Str2:</span><br><span class="line">        <span class="keyword">if</span> <span class="number">32</span> &lt;= byte &lt;= <span class="number">126</span>:</span><br><span class="line">            ascii_part2 += <span class="built_in">chr</span>(byte)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ascii_part2 += <span class="string">&quot;?&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Part 2 (ASCII): <span class="subst">&#123;ascii_part2&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ascii_part2</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_data</span>(<span class="params">index</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;模拟get_data函数&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> index == <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">95</span></span><br><span class="line">    <span class="keyword">elif</span> index == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1849713503</span></span><br><span class="line">    <span class="keyword">elif</span> index == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1999654495</span></span><br><span class="line">    <span class="keyword">elif</span> index == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1429240159</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_flag3</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;解密第三部分flag - 使用正确的随机种子&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n=== Part 3 Decryption ===&quot;</span>)</span><br><span class="line"></span><br><span class="line">    encrypted_part3 = [<span class="number">0xCD</span>, <span class="number">0xCE</span>, <span class="number">0xD0</span>, <span class="number">0x58</span>, <span class="number">0x5D</span>, <span class="number">0x92</span>, <span class="number">0x42</span>, <span class="number">0xB1</span>, <span class="number">0x7C</span>, <span class="number">0xA9</span>, <span class="number">0xFF</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 尝试不同的随机种子</span></span><br><span class="line">    seeds_to_try = [<span class="number">0x1337</span>, <span class="number">0x1234</span>, <span class="number">0xDEAD</span>, <span class="number">0xBEEF</span>, <span class="number">0xCAFE</span>, <span class="number">0x1337C0DE</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1337</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> seed <span class="keyword">in</span> seeds_to_try:</span><br><span class="line">        random.seed(seed)</span><br><span class="line">        rand_sequence = [random.randint(<span class="number">0</span>, <span class="number">255</span>) &amp; <span class="number">0xFF</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(encrypted_part3))]</span><br><span class="line"></span><br><span class="line">        decrypted = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(encrypted_part3)):</span><br><span class="line">            decrypted_byte = encrypted_part3[i] ^ rand_sequence[i]</span><br><span class="line">            decrypted.append(decrypted_byte)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 检查是否都是可打印ASCII</span></span><br><span class="line">        all_printable = <span class="built_in">all</span>(<span class="number">32</span> &lt;= byte &lt;= <span class="number">126</span> <span class="keyword">for</span> byte <span class="keyword">in</span> decrypted)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> all_printable:</span><br><span class="line">            part3 = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> decrypted)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Found valid Part 3 with seed <span class="subst">&#123;<span class="built_in">hex</span>(seed)&#125;</span>: <span class="subst">&#123;part3&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> part3</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 如果没有找到完全可打印的，显示最可能的结果</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;No fully printable sequence found. Trying seed 0x1337 (common CTF seed):&quot;</span>)</span><br><span class="line">    random.seed(<span class="number">0x1337</span>)</span><br><span class="line">    rand_sequence = [random.randint(<span class="number">0</span>, <span class="number">255</span>) &amp; <span class="number">0xFF</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(encrypted_part3))]</span><br><span class="line"></span><br><span class="line">    decrypted = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(encrypted_part3)):</span><br><span class="line">        decrypted_byte = encrypted_part3[i] ^ rand_sequence[i]</span><br><span class="line">        decrypted.append(decrypted_byte)</span><br><span class="line"></span><br><span class="line">    part3 = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(b) <span class="keyword">if</span> <span class="number">32</span> &lt;= b &lt;= <span class="number">126</span> <span class="keyword">else</span> <span class="string">f&#x27;\\x<span class="subst">&#123;b:02x&#125;</span>&#x27;</span> <span class="keyword">for</span> b <span class="keyword">in</span> decrypted)</span><br><span class="line">    ascii_part3 = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(b) <span class="keyword">if</span> <span class="number">32</span> &lt;= b &lt;= <span class="number">126</span> <span class="keyword">else</span> <span class="string">&#x27;?&#x27;</span> <span class="keyword">for</span> b <span class="keyword">in</span> decrypted)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Part 3 bytes: <span class="subst">&#123;[<span class="built_in">hex</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> decrypted]&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Part 3: <span class="subst">&#123;part3&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Part 3 (ASCII): <span class="subst">&#123;ascii_part3&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ascii_part3</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">combine_flag</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;组合完整的flag&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;COMBINING COMPLETE FLAG&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">    part1 = decrypt_flag1()</span><br><span class="line">    part2 = decrypt_flag2()</span><br><span class="line">    part3 = decrypt_flag3()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n=== FINAL FLAG ===&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Part 1: <span class="subst">&#123;part1&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Part 2: <span class="subst">&#123;part2&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Part 3: <span class="subst">&#123;part3&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 组合flag格式: flag&#123;part1_part2_part3&#125;</span></span><br><span class="line">    <span class="comment"># 但根据flag1，part1已经包含 &quot;flag&#123;&quot; 开头</span></span><br><span class="line">    final_flag = <span class="string">f&quot;<span class="subst">&#123;part1&#125;</span>_<span class="subst">&#123;part2&#125;</span>_<span class="subst">&#123;part3&#125;</span>&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\nFINAL FLAG: <span class="subst">&#123;final_flag&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新导入random</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    combine_flag()</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">=== FINAL FLAG ===</span><br><span class="line">Part 1: flag&#123;G00d!!!</span><br><span class="line">Part 2: _N0w_y0U_c@n_</span><br><span class="line">Part 3: ???&#123;By??H??</span><br><span class="line"></span><br><span class="line">FINAL FLAG: flag&#123;G00d!!!__N0w_y0U_c@n__???&#123;By??H??</span><br></pre></td></tr></table></figure>

<p>第三段flag点进去后会发现有一个假函数 也就是 flag3_fake</p>
<p>通过逆向找到真函数代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __noreturn <span class="title function_">gift2</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+2Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  srand(<span class="number">0x1234</span>u);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; dword_7FF7D240202C; ++i )</span><br><span class="line">    encrypted[i] ^= rand();</span><br><span class="line">  _mingw_printf(<span class="string">&quot;Decrypted part 3: &quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; dword_7FF7D240202C; ++j )</span><br><span class="line">    <span class="built_in">putchar</span>(encrypted[j]);</span><br><span class="line">  <span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;\nPress any key to exit...&quot;</span>);</span><br><span class="line">  system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.data:00007FF7D2402020                                         ; DATA XREF: gift2+28↑o</span><br><span class="line">.data:00007FF7D2402020                                         ; gift2+3D↑o ...</span><br><span class="line">.data:00007FF7D240202A                 db 0FFh, 0</span><br><span class="line">.data:00007FF7D240202C dword_7FF7D240202C dd 0Bh               ; DATA XREF: gift2:loc_7FF7D23F198B↑r</span><br><span class="line">.data:00007FF7D240202C                                         ; gift2:loc_7FF7D23F19CC↑r</span><br><span class="line">.data:00007FF7D2402030 ; Function-local static variable</span><br><span class="line">.data:00007FF7D2402030 ; func_ptr *p_0</span><br><span class="line">.data:00007FF7D2402030 p_0             dq offset qword_7FF7D2401560</span><br><span class="line">.data:00007FF7D2402030                                         ; DATA XREF: __do_global_</span><br></pre></td></tr></table></figure>

<p>但是直接逆向有点困难</p>
<p>于是我们直接修改 flag3_fake()的汇编代码，让其永久循环被跳过</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">; Attributes: <span class="keyword">noreturn</span> bp-based frame</span><br><span class="line"></span><br><span class="line">; <span class="type">void</span> __noreturn <span class="title function_">flag3_fake</span><span class="params">()</span></span><br><span class="line">public flag3_fake</span><br><span class="line">flag3_fake proc near</span><br><span class="line">push    rbp</span><br><span class="line">mov     rbp, rsp</span><br><span class="line">sub     rsp, 20h</span><br><span class="line">lea     rax, aWhereIsFlag3Le ; <span class="string">&quot;\nWhere is flag3? Let me think...&quot;</span></span><br><span class="line">mov     rcx, rax        ; Buffer</span><br><span class="line">call    <span class="built_in">puts</span></span><br><span class="line">lea     rax, aMaybeYouNeedTo ; <span class="string">&quot;Maybe you need to use IDA to find the r&quot;</span>...</span><br><span class="line">mov     rcx, rax        ; Buffer</span><br><span class="line">call    <span class="built_in">puts</span></span><br><span class="line">loc_7FF7D23F172E:       ; dwMilliseconds</span><br><span class="line">mov     ecx, <span class="number">3E8</span>h</span><br><span class="line">mov     rax, cs:__imp_Sleep</span><br><span class="line">flag3_fake endp ; sp-analysis failed</span><br></pre></td></tr></table></figure>

<p>即可解出flag</p>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3><h3 id="babyRSA"><a href="#babyRSA" class="headerlink" title="babyRSA"></a>babyRSA</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">n = <span class="number">20116181115185256137151544962617461969127485079539874123483790179691451026659727409952002522890170053136432251484598758202749921581090222404128778286934496528266389586853622784941814905724374659722595150921699219297623333597701057604954651692729250881800409786303147914726282180533059864870515367790648247781809163302813093152120079755029826297153011886828297246071460547641705486357297417233767122432498694486964352342801912061641754894572829465334992075139630449930115173945624459850685926333265959551792326024379566586598102224813413893610109613076229994854338779713676554568790353735720642800095499489845542499243</span></span><br><span class="line">c1 = <span class="number">12574615186232508658058781239986357997690221455470707882708919538344867889046756940392586425215083828833917124513057649780713973391884806015516720789553246206689136824212927709627728801288304629797527956697243414600762350309939098109707454770146886759387428373061131102235552303687641823437812335805429238591967849935403611629054866383093303269886760991083623181420555220699498615783586898665752705379697907365417049724321589193519522361497873285356095894318360385694468646045503420079559869794438944147268173957051158766280963203638656844473553699835099487100606197891044561669390594778573658401240732422863142027023</span></span><br><span class="line">c2 = <span class="number">8662571349644155432847824828393121776098409938437916669251107156874603954233944520039184762114790042807930511195272715449923236367967421315595229284040395158368328305331059953339506075385510377512416235056474493145376149687125036012499178684540639274797034307771820863938251633851132423882652884158338847776108707048056678532767030904154141724336547346190841924329986431350894721191694788035732072169271856487733779585742838903331792853668246043440328934976370767441620664696662437609635592559825455438053522844176591659902503216608366261175995953153271651775486985191394510128456927543378761783994086684673696547021</span></span><br><span class="line"></span><br><span class="line">e1 = <span class="number">65537</span></span><br><span class="line">e2 = <span class="number">2333</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用扩展欧几里得算法找到 s 和 t，使得 e1*s + e2*t = gcd(e1, e2) = 1</span></span><br><span class="line">g, s, t = gmpy2.gcdext(e1, e2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据 s 和 t 的符号计算 m</span></span><br><span class="line"><span class="keyword">if</span> s &lt; <span class="number">0</span>:</span><br><span class="line">    part1 = <span class="built_in">pow</span>(gmpy2.invert(c1, n), -s, n)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    part1 = <span class="built_in">pow</span>(c1, s, n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> t &lt; <span class="number">0</span>:</span><br><span class="line">    part2 = <span class="built_in">pow</span>(gmpy2.invert(c2, n), -t, n)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    part2 = <span class="built_in">pow</span>(c2, t, n)</span><br><span class="line"></span><br><span class="line">m = (part1 * part2) % n</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将明文转换为字节串</span></span><br><span class="line">flag = long_to_bytes(m)</span><br><span class="line"><span class="built_in">print</span>(flag.decode())</span><br></pre></td></tr></table></figure>

<h3 id="Lulala"><a href="#Lulala" class="headerlink" title="Lulala"></a>Lulala</h3><p>这题是时间隐写，直接搞出gif时间戳写脚本做就行了</p>
<hr>
<p>后面不太好讲了，有道AES解密找不到当时写的脚本了，等后面如果有题目复现继续补充</p>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="true">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        
                            <li title="0" data-url="https://blog.curesky.site/audio/yinlang.mp3"></li>
                        
                    
                </ul>
            
        </div>
        
        
    <div id="gitalk-container" class="comment link"
		data-enable="true"
        data-ae="true"
        data-ci="10a7f71656553fd4676c"
        data-cs="48f8d183288b4d0b2531f047719dee43bdc913ec"
        data-r="allureluoli.github.io"
        data-o="allureluoli"
        data-a="allureluoli"
        data-d="false"
    >查看评论</div>


    </div>
    
        <div class="side">
            <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#FZNCTF-2025"><span class="toc-number">1.</span> <span class="toc-text">FZNCTF 2025</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#WEB-%E7%AD%BE%E5%88%B0-check-in"><span class="toc-number">1.1.</span> <span class="toc-text">WEB 签到 check_in</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">2.</span> <span class="toc-text">重定向?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B8%E7%A5%9E%E7%9A%84%E4%B8%89%E8%AF%95%E7%82%BC"><span class="toc-number">3.</span> <span class="toc-text">诸神的三试炼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#babyRSA"><span class="toc-number">5.</span> <span class="toc-text">babyRSA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lulala"><span class="toc-number">6.</span> <span class="toc-text">Lulala</span></a></li></ol>
        </div>
    
</div>
    </div>
</div>
</body>

<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>


<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/typed.js"></script>
<script src="/js/diaspora.js"></script>


<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">


<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>






</html>
